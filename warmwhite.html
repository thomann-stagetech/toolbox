<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kelvin zu RGB (DMX)</title>
<style>
  :root{
    --primary:#00b5bd;
    --bg:#f8f8f8;
    --card:#ffffff;
    --text:#222;
    --muted:#666;
    --radius:16px;
    --shadow:0 8px 24px rgba(0,0,0,.08);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}

  header{
    position:sticky;top:0;z-index:10;
    background:var(--primary);color:#fff;padding:16px 20px;text-align:center;
    box-shadow:0 2px 8px rgba(0,0,0,.12)
  }
  header h1{margin:0;font-size:clamp(18px,3vw,22px);letter-spacing:.2px}

  .back{
    position:absolute;left:12px;top:10px;
    background:#fff;color:var(--primary);border:none;border-radius:10px;
    padding:8px 12px;font-weight:700;cursor:pointer;box-shadow:var(--shadow)
  }
  .back:focus-visible{outline:3px solid color-mix(in oklab,var(--primary) 40%,white)}

  main{
    max-width:980px;margin:28px auto;padding:0 18px;
    animation:fadeUp .48s ease both;
  }
  @keyframes fadeUp{
    from{opacity:0; transform:translateY(8px)}
    to{opacity:1; transform:translateY(0)}
  }

  .card{
    background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);
    padding:20px;margin-bottom:18px;animation:fadeUp .5s ease both;
  }
  .card:nth-child(2){animation-delay:.05s}
  .card:nth-child(3){animation-delay:.1s}
  .card h2{margin:0 0 10px;font-size:20px}
  .muted{color:var(--muted)}

  .row{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
  .grow{flex:1 1 320px}

  /* Slider – groß & benutzerfreundlich */
  .slider-wrap{display:flex;align-items:center;gap:14px}
  input[type="number"]{
    width:140px;max-width:100%;
    padding:12px;border-radius:12px;border:1px solid #ddd;font-weight:600;text-align:center;
    background:#fff; box-shadow: inset 0 1px 0 rgba(0,0,0,.03);
  }
  input[type="range"]{
    -webkit-appearance:none;appearance:none;width:100%;height:14px;border-radius:999px;background:#e9e9e9;outline:none;
  }
  input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none;appearance:none;width:28px;height:28px;border-radius:50%;
    background:var(--primary);border:3px solid #fff;box-shadow:0 2px 6px rgba(0,0,0,.25);cursor:pointer;margin-top:-7px
  }
  input[type="range"]::-moz-range-thumb{
    width:28px;height:28px;border-radius:50%;background:var(--primary);border:3px solid #fff;box-shadow:0 2px 6px rgba(0,0,0,.25);cursor:pointer
  }

  .preview{
    height:120px;border-radius:14px;border:1px solid #e6e6e6;box-shadow:inset 0 1px 0 rgba(0,0,0,.04)
  }

  .grid{
    display:grid;gap:16px;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  }

  .kv{
    display:grid;grid-template-columns:auto 1fr;gap:6px 10px;align-items:center;
    font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
    font-size:15px
  }
  .kv .key{color:#444}
  .kv .val{font-weight:700}
  .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#eefbfd;color:#065a60;font-weight:700;border:1px solid #c7eef1;font-size:.9rem}

  footer{max-width:980px;margin:20px auto 32px;padding:0 18px;color:var(--muted);font-size:.95rem;text-align:center}
</style>
</head>
<body>
  <header>
    <button class="back" onclick="location.href='index.html'">← Zurück zur Toolbox</button>
    <h1>Kelvin → LED-Mix (RGB / RGBW / RGBWA+UV / RGBLAC)</h1>
  </header>

  <main>
    <!-- Steuerung -->
    <section class="card">
      <h2>Farbtemperatur wählen</h2>
      <p class="muted">Ziehe den Regler oder gib einen Kelvin-Wert ein. Bereich: 1.000 K – 12.000 K.</p>
      <div class="row">
        <div class="grow slider-wrap">
          <input id="kelvinRange" type="range" min="1000" max="12000" step="50" value="3200" />
        </div>
        <div>
          <label for="kelvinInput" class="muted" style="display:block;margin-bottom:6px">Kelvin</label>
          <input id="kelvinInput" type="number" min="1000" max="12000" step="50" value="3200" />
        </div>
      </div>
      <div class="preview" id="preview" style="margin-top:14px"></div>
      <p class="muted" style="margin-top:10px">
        <span class="badge" id="kelvinBadge">3200 K</span>
      </p>
    </section>

    <!-- Ergebnisse -->
    <section class="card">
      <h2>DMX-Werte</h2>
      <div class="grid">
        <div class="subcard">
          <h3 class="muted" style="margin:0 0 8px">RGB</h3>
          <div class="kv">
            <div class="key">R</div><div class="val" id="rgbR">—</div>
            <div class="key">G</div><div class="val" id="rgbG">—</div>
            <div class="key">B</div><div class="val" id="rgbB">—</div>
          </div>
        </div>

        <div class="subcard">
          <h3 class="muted" style="margin:0 0 8px">RGBW</h3>
          <div class="kv">
            <div class="key">R</div><div class="val" id="rgbwR">—</div>
            <div class="key">G</div><div class="val" id="rgbwG">—</div>
            <div class="key">B</div><div class="val" id="rgbwB">—</div>
            <div class="key">W</div><div class="val" id="rgbwW">—</div>
          </div>
        </div>

        <div class="subcard">
          <h3 class="muted" style="margin:0 0 8px">RGBWA+UV</h3>
          <div class="kv">
            <div class="key">R</div><div class="val" id="rgbwauvR">—</div>
            <div class="key">G</div><div class="val" id="rgbwauvG">—</div>
            <div class="key">B</div><div class="val" id="rgbwauvB">—</div>
            <div class="key">W</div><div class="val" id="rgbwauvW">—</div>
            <div class="key">A</div><div class="val" id="rgbwauvA">—</div>
            <div class="key">UV</div><div class="val" id="rgbwauvUV">—</div>
          </div>
        </div>

        <div class="subcard">
          <h3 class="muted" style="margin:0 0 8px">RGBLAC</h3>
          <div class="kv">
            <div class="key">R</div><div class="val" id="rgblacR">—</div>
            <div class="key">G</div><div class="val" id="rgblacG">—</div>
            <div class="key">B</div><div class="val" id="rgblacB">—</div>
            <div class="key">L</div><div class="val" id="rgblacL">—</div>
            <div class="key">A</div><div class="val" id="rgblacA">—</div>
            <div class="key">C</div><div class="val" id="rgblacC">—</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    © 2025 • DMX Toolbox • thomann.de
  </footer>

<script>
/* ---------- Kelvin → RGB (Standard Approximation) ---------- */
function kelvinToRGB(k){
  const t = k/100;
  let r,g,b;
  if (t <= 66){
    r = 255;
    g = 99.4708025861 * Math.log(t) - 161.1195681661;
    b = (t <= 19) ? 0 : (138.5177312231 * Math.log(t - 10) - 305.0447927307);
  } else {
    r = 329.698727446 * Math.pow(t - 60, -0.1332047592);
    g = 288.1221695283 * Math.pow(t - 60, -0.0755148492);
    b = 255;
  }
  return [
    Math.max(0, Math.min(255, r)),
    Math.max(0, Math.min(255, g)),
    Math.max(0, Math.min(255, b))
  ];
}

/* Helpers */
const clamp01 = v => Math.max(0, Math.min(1, v));
const round = v => Math.round(v);

/* allocate a channel vector from remaining RGB (all 0..255)
   vec: [r,g,b] with components 0..1 (profile of LED channel)
   weight: 0..1 fraction of the theoretical max to allocate
*/
function allocate(rem, vec, weight, cap=0.8){
  // find maximum amount we could take without going negative
  let maxAmt = Infinity;
  for (let i=0;i<3;i++){
    if (vec[i] > 0){
      maxAmt = Math.min(maxAmt, rem[i] / vec[i]);
    }
  }
  if (!isFinite(maxAmt)) maxAmt = 0; // vec all zeros
  const amt = Math.max(0, maxAmt * cap * clamp01(weight));
  // subtract
  const out = [rem[0], rem[1], rem[2]];
  for (let i=0;i<3;i++){
    out[i] = Math.max(0, out[i] - amt * vec[i]);
  }
  return { amount: amt, rem: out };
}

function fmtRGB(arr){ return arr.map(v=>round(v)).join(', '); }

/* ---------- Build mixes ---------- */
function computeAll(kelvin){
  // Base RGB from CCT
  let [r, g, b] = kelvinToRGB(kelvin);
  // Color preview
  document.getElementById('preview').style.background = `rgb(${round(r)}, ${round(g)}, ${round(b)})`;

  // RGB (8-bit DMX)
  document.getElementById('rgbR').textContent = round(r);
  document.getElementById('rgbG').textContent = round(g);
  document.getElementById('rgbB').textContent = round(b);

  // Extract white first (shared for other mixes)
  const W = Math.min(r,g,b);
  let remR = r - W, remG = g - W, remB = b - W;

  // RGBW
  document.getElementById('rgbwR').textContent = round(remR);
  document.getElementById('rgbwG').textContent = round(remG);
  document.getElementById('rgbwB').textContent = round(remB);
  document.getElementById('rgbwW').textContent = round(W);

  /* ---------- RGBWA+UV heuristic ----------
     Amber helps for warm CCT; UV is not visible → keep 0 by default.
     We re-use white extraction; then allocate amber from remaining RGB.
  */
  (function(){
    let rem = [remR, remG, remB];
    const amberVec = [1.0, 0.70, 0.0]; // approximate amber contribution in sRGB space
    // weight: 1 at 1800K → 0 at 4600K
    const wA = clamp01((4600 - kelvin) / (4600 - 1800));
    const { amount: A, rem: rem2 } = allocate(rem, amberVec, wA, 0.85);
    rem = rem2;

    const outR = round(rem[0]), outG = round(rem[1]), outB = round(rem[2]);
    document.getElementById('rgbwauvR').textContent = outR;
    document.getElementById('rgbwauvG').textContent = outG;
    document.getElementById('rgbwauvB').textContent = outB;
    document.getElementById('rgbwauvW').textContent = round(W);
    document.getElementById('rgbwauvA').textContent = round(A);
    document.getElementById('rgbwauvUV').textContent = 0; // UV bleibt 0 (nicht sichtbar)
  })();

  /* ---------- RGBLAC heuristic ----------
     Nach Weiß extrahieren:
     - Amber (warm, unter ~4600K)
     - Lime (grünlastig, um ~5600K peak)
     - Cyan (kühl, ab ~7000K)
     Rest bleibt auf RGB.
  */
  (function(){
    let rem = [remR, remG, remB];

    const amberVec = [1.0, 0.70, 0.0];
    const limeVec  = [0.60, 1.00, 0.20];
    const cyanVec  = [0.00, 1.00, 1.00];

    const wA = clamp01((4600 - kelvin) / (4600 - 1800));                   // warm
    const wL = clamp01(1 - Math.abs(kelvin - 5600) / 2000);                // peak around 5600K
    const wC = clamp01((kelvin - 7000) / (11000 - 7000));                  // cool

    const a1 = allocate(rem, amberVec, wA, 0.85); rem = a1.rem;
    const a2 = allocate(rem, limeVec,  wL, 0.80); rem = a2.rem;
    const a3 = allocate(rem, cyanVec,  wC, 0.80); rem = a3.rem;

    document.getElementById('rgblacR').textContent = round(rem[0]);
    document.getElementById('rgblacG').textContent = round(rem[1]);
    document.getElementById('rgblacB').textContent = round(rem[2]);
    document.getElementById('rgblacL').textContent = round(a2.amount);
    document.getElementById('rgblacA').textContent = round(a1.amount);
    document.getElementById('rgblacC').textContent = round(a3.amount);
  })();
}

/* ---------- UI wiring ---------- */
const kRange = document.getElementById('kelvinRange');
const kInput = document.getElementById('kelvinInput');
const kBadge = document.getElementById('kelvinBadge');

function syncKelvin(val){
  const k = Math.max(1000, Math.min(12000, Math.round(val)));
  kRange.value = k;
  kInput.value = k;
  kBadge.textContent = k.toLocaleString('de-DE') + ' K';
  computeAll(k);
}

kRange.addEventListener('input', e => syncKelvin(e.target.value));
kInput.addEventListener('input', e => syncKelvin(e.target.value));

// initial render
syncKelvin(kInput.value);
</script>
</body>
</html>
